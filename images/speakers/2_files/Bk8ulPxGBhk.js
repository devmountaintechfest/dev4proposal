;/*FB_PKG_DELIM*/

__d("LSUpdateMessageSearchQueryStatus",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(70).put({query:a[0],type_:a[1],threadKeyV2:a[5]==null?b.i64.cast([0,0]):a[5],status:a[2],hasNextPage:a[3],nextPageCursor:a[4],resultCount:a[6]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSSearchUpdateMessageSearchQueryStatusStoredProcedure";e.exports=a}),null);
__d("LSIssueMessageSearchQuery",["LSIssueNewTask","LSUpdateMessageSearchQueryStatus"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return c.storedProcedure(b("LSUpdateMessageSearchQueryStatus"),a[0],a[1],c.i64.cast([0,1]),void 0,a[3],a[2],c.i64.cast([0,0]))},function(e){return d[0]=new c.Map(),d[0].set("query",a[0]),d[0].set("type",a[1]),d[0].set("thread_key",a[2]),d[0].set("next_page_cursor",a[3]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"message_search",c.i64.cast([0,107]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSSearchIssueMessageSearchQueryStoredProcedure";e.exports=a}),null);
__d("LSIssueMessageSearchQueryStoredProcedure",["LSIssueMessageSearchQuery","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){return c("LSIssueMessageSearchQuery")(b.query,b.type_,b.threadKey,b.nextPageCursor,a)}g["default"]=a}),98);
__d("useMWPConversatioSearchQPLLogger",["QPLUserFlow","emptyFunction","qpl","react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useCallback,j=b.useMemo,k={currentResultCount:0,firstResultShowUp:!1,hasStarted:!1,instanceKey:0};function a(){var a=i(function(a){var b=a.annotations,d=a.instanceKey;a=a.point;if(!k.hasStarted)return;if(d!=null&&d!==k.instanceKey)return;c("QPLUserFlow").addPoint(c("qpl")._(25301522,"2409"),a,{data:b,instanceKey:k.instanceKey})},[]),b=i(function(a){if(!k.hasStarted)return;if(a!=null&&a!==k.instanceKey)return;k.hasStarted=!1;c("QPLUserFlow").endCancel(c("qpl")._(25301522,"2409"),{annotations:{"int":{result_count:k.currentResultCount}},instanceKey:k.instanceKey})},[]),d=i(function(a){k.hasStarted&&b();k.hasStarted=!0;k.instanceKey++;k.firstResultShowUp=!1;k.currentResultCount=0;c("QPLUserFlow").start(c("qpl")._(25301522,"2409"),{annotations:a,instanceKey:k.instanceKey});return k.instanceKey},[b]),e=i(function(a){if(!k.hasStarted)return;if(a!=null&&a!==k.instanceKey)return;k.hasStarted=!1;c("QPLUserFlow").endSuccess(c("qpl")._(25301522,"2409"),{annotations:{"int":{result_count:k.currentResultCount}},instanceKey:k.instanceKey})},[]),f=i(function(b){if(k.firstResultShowUp)return;k.firstResultShowUp=!0;a({instanceKey:b,point:"first_result_show_up"})},[a]),g=i(function(a){k.currentResultCount=a},[]),h=i(function(){return k.instanceKey},[]),l=j(function(){return{getCurrentInstanceKey:h,qplAddAnnotations:c("emptyFunction"),qplAddPoint:a,qplCancel:b,qplMarkFirstResultShowUp:f,qplStart:d,qplSuccess:e,updateCurrentResultCount:g}},[h,a,b,f,d,e,g]);return l}g["default"]=a}),98);
__d("useMWPConversationSearch",["I64","LSFactory","LSIntEnum","LSIssueMessageSearchQueryStoredProcedure","LSMessageSearchType","LSSearchRequestStatusType","MAWFTSRawStringMatcher","MAWThreadCutover","MWPConversationSearchContext.react","MWPConversationSearchLogger","MWPVisibleMessageContext.react","Promise","ReQL","ReQLSuspense","cr:7230","isMWNewSearchUXEnabled","nullthrows","promiseDone","react","useMWPConversatioSearchQPLLogger","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;e=j||d("react");e.useCallback;var m=e.useContext,n=e.useEffect;e.useMemo;var o=e.useRef,p=e.c,q=(k||(k=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),r="useMWPConversationSearch";function s(a,b){a=[a,b].filter(Boolean);b=a.filter(function(a){return(k||(k=d("LSIntEnum"))).toNumber(a.status)===c("LSSearchRequestStatusType").COMPLETE});return b.length===0||b.length<a.length?void 0:b.reduce(function(a,b){return a+(l||(l=d("I64"))).to_float(b.resultCount)},0)}function t(a,b){if(b==null)return a==null?void 0:a.status;if(a==null)return b==null?void 0:b.status;if((k||(k=d("LSIntEnum"))).toNumber(a.status)===c("LSSearchRequestStatusType").FAILED||(k||(k=d("LSIntEnum"))).toNumber(b.status)===c("LSSearchRequestStatusType").FAILED)return(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").FAILED);a=Math.min((k||(k=d("LSIntEnum"))).toNumber(a.status),k.toNumber(b.status));return k.ofNumber(a)}function u(a,b){c("promiseDone")(a.runInTransaction(function(a){return c("LSIssueMessageSearchQueryStoredProcedure")(c("LSFactory")(a),{nextPageCursor:b.nextPageCursor,query:b.query,threadKey:b.threadKeyV2,type_:q})},"readwrite",void 0,void 0,f.id+":99"))}function a(a){var e=p(86),g=m(d("MWPConversationSearchContext.react").context),j;e[0]!==g?(j=c("nullthrows")(g),e[0]=g,e[1]=j):j=e[1];g=j;var v=g.search,w=g.setSearch;j=c("useMWPConversatioSearchQPLLogger")();var x=j.qplCancel,y=j.qplMarkFirstResultShowUp,z=j.updateCurrentResultCount,A=o(null);g=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext();var B=g.setVisibleMessage,C=(i||(i=c("useReStore")))(),D=d("MAWThreadCutover").useGetCutoverMapping(v==null?void 0:v.threadKey);e[2]!==v||e[3]!==C||e[4]!==a?(j=function(){return v!=null?d("ReQL").fromTableAscending(C.tables.message_search_queries).getKeyRange(q,v.query,a):d("ReQL").empty()},g=[C,v,a],e[2]=v,e[3]=C,e[4]=a,e[5]=j,e[6]=g):(j=e[5],g=e[6]);var E=d("ReQLSuspense").useFirst(j,g,f.id+":140");e[7]!==v||e[8]!==D||e[9]!==C?(j=function(){return v!=null&&D!=null&&D.showOpenMessageHistory===!0?d("ReQL").fromTableAscending(C.tables.message_search_queries).getKeyRange(q,v.query,D.openThreadId):d("ReQL").empty()},g=[C,v,D],e[7]=v,e[8]=D,e[9]=C,e[10]=j,e[11]=g):(j=e[10],g=e[11]);var F=d("ReQLSuspense").useFirst(j,g,f.id+":152"),G=v==null?void 0:v.query;e[12]!==v||e[13]!==x?(j=function(){v==null&&x()},g=[x,v],e[12]=v,e[13]=x,e[14]=j,e[15]=g):(j=e[14],g=e[15]);n(j,g);e[16]===Symbol["for"]("react.memo_cache_sentinel")?(j=function(){var a,e;e=null;c("promiseDone")((h||(h=b("Promise"))).all([(a=b("cr:7230")==null?void 0:b("cr:7230").getInstance().then(function(a){e=a}))!=null?a:(h||(h=b("Promise"))).resolve(),d("MAWFTSRawStringMatcher").load().then(function(a){A.current=a})]));return function(){var a;(a=e)==null?void 0:a.removeNewMessagesListener(r)}},g=[],e[16]=j,e[17]=g):(j=e[16],g=e[17]);n(j,g);e[18]!==B?(j=function(a){B(function(b){return{contextLine:(b=a.contextLine)!=null?b:"",highlights:a.matchOffsets!=null&&a.matchLengths!=null?function(a,b){a=a.split(",");var c=b.split(",");return a.map(function(a,b){return{matchLength:parseInt(c[b],10),matchOffset:parseInt(a,10)}})}(a.matchOffsets,a.matchLengths):[],messageId:a.messageId,messageOtid:a.messageOtid,source:"Search",timestamp:c("nullthrows")(a.messageTimestampMs)}})},e[18]=B,e[19]=j):j=e[19];var H=j;e[20]!==G||e[21]!==C||e[22]!==a?(g=function(){return G!=null?d("ReQL").fromTableAscending(C.tables.message_search_results).getKeyRange(q,G,a):d("ReQL").empty()},j=[C,G,a],e[20]=G,e[21]=C,e[22]=a,e[23]=g,e[24]=j):(g=e[23],j=e[24]);g=d("ReQLSuspense").useArray(g,j,f.id+":218");var I;e[25]!==G||e[26]!==D||e[27]!==C?(j=function(){return G!=null&&D!=null&&D.showOpenMessageHistory===!0?d("ReQL").fromTableAscending(C.tables.message_search_results).getKeyRange(q,G,D.openThreadId):d("ReQL").empty()},I=[C,G,D],e[25]=G,e[26]=D,e[27]=C,e[28]=j,e[29]=I):(j=e[28],I=e[29]);j=d("ReQLSuspense").useArray(j,I,f.id+":231");e[30]!==g||e[31]!==j?(I=[].concat(g,j),e[30]=g,e[31]=j,e[32]=I):I=e[32];g=I;var J=g;e[33]!==z||e[34]!==J.length?(j=function(){z(J.length)},e[33]=z,e[34]=J.length,e[35]=j):j=e[35];e[36]!==J||e[37]!==z?(I=[J,z],e[36]=J,e[37]=z,e[38]=I):I=e[38];n(j,I);var K=o(),L=v==null?void 0:v.selectedSearchResultIndex;e[39]!==J||e[40]!==L||e[41]!==y||e[42]!==H?(g=function(){if(J.length>0&&L!=null&&L<J.length){var a=J[L];K.current!==a&&(y(),c("isMWNewSearchUXEnabled")()||(c("MWPConversationSearchLogger").logMessageSearchMsgImpression(),H(a)),K.current=a)}},e[39]=J,e[40]=L,e[41]=y,e[42]=H,e[43]=g):g=e[43];e[44]!==H||e[45]!==J||e[46]!==L||e[47]!==B||e[48]!==y?(j=[H,J,L,B,y],e[44]=H,e[45]=J,e[46]=L,e[47]=B,e[48]=y,e[49]=j):j=e[49];n(g,j);e[50]!==H?(I=function(a){H(a)},e[50]=H,e[51]=I):I=e[51];g=I;e[52]!==v||e[53]!==L||e[54]!==J.length||e[55]!==E||e[56]!==C||e[57]!==F||e[58]!==w?(j=function(){if(v==null)return null;L===J.length-1&&(E==null?void 0:E.hasNextPage)===!0?u(C,E):L===J.length-1&&(F==null?void 0:F.hasNextPage)===!0&&u(C,F);w(babelHelpers["extends"]({},v,{selectedSearchResultIndex:v.selectedSearchResultIndex+1}));return v.selectedSearchResultIndex+1},e[52]=v,e[53]=L,e[54]=J.length,e[55]=E,e[56]=C,e[57]=F,e[58]=w,e[59]=j):j=e[59];I=j;e[60]!==v||e[61]!==w?(j=function(){if(v==null)return null;w(babelHelpers["extends"]({},v,{selectedSearchResultIndex:v.selectedSearchResultIndex-1}));return v.selectedSearchResultIndex-1},e[60]=v,e[61]=w,e[62]=j):j=e[62];j=j;var M;e[63]!==E||e[64]!==F?(M=t(E,F),e[63]=E,e[64]=F,e[65]=M):M=e[65];var N=M;M=(E==null?void 0:E.hasNextPage)===!0||(F==null?void 0:F.hasNextPage)===!0;var O;e[66]!==v||e[67]!==N||e[68]!==E||e[69]!==C||e[70]!==F?(O=function(){var a;if(v==null||(l||(l=d("I64"))).equal((a=N)!=null?a:(l||(l=d("I64"))).zero,(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").PENDING)))return;(E==null?void 0:E.hasNextPage)===!0?u(C,E):(F==null?void 0:F.hasNextPage)===!0&&u(C,F)},e[66]=v,e[67]=N,e[68]=E,e[69]=C,e[70]=F,e[71]=O):O=e[71];O=O;var P;e[72]!==E||e[73]!==F?(P=s(E,F),e[72]=E,e[73]=F,e[74]=P):P=e[74];P=P;var Q=v==null?void 0:v.query,R;e[75]!==M||e[76]!==O||e[77]!==g||e[78]!==I||e[79]!==j||e[80]!==Q||e[81]!==P||e[82]!==J||e[83]!==L||e[84]!==N?(R={hasMore:M,loadMore:O,navigateToResult:g,next:I,previous:j,query:Q,resultCount:P,searchResults:J,selectedSearchResultIndex:L,status:N},e[75]=M,e[76]=O,e[77]=g,e[78]=I,e[79]=j,e[80]=Q,e[81]=P,e[82]=J,e[83]=L,e[84]=N,e[85]=R):R=e[85];return R}g["default"]=a}),98);
__d("MWInboxMessageSearchContext.react",["emptyFunction","react","useMWPConversationSearch"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;f=e.createContext;var j=e.useContext,k=e.c,l=f({hasMore:void 0,loadMore:c("emptyFunction"),navigateToResult:c("emptyFunction"),next:c("emptyFunction"),previous:c("emptyFunction"),query:void 0,resultCount:void 0,searchResults:[],selectedSearchResultIndex:void 0,status:void 0});function a(a){var b=k(3),d=a.children;a=a.thread;a=c("useMWPConversationSearch")(a.threadKey);var e;b[0]!==a||b[1]!==d?(e=i.jsx(l.Provider,{value:a,children:d}),b[0]=a,b[1]=d,b[2]=e):e=b[2];return e}function b(){return j(l)}g.MWInboxMessageSearchContext=a;g.useMWInboxMessageSearchContext=b}),98);
__d("useMWInboxMessageSearchRestoreLoopLoadedUntilDate",["MAWBridgeSendAndReceive","asyncToGeneratorRuntime","react"],(function(a,b,c,d,e,f,g){"use strict";var h;c=h||d("react");var i=c.useEffect,j=c.useState,k=c.c;function a(a){var c=k(3),e=j(null),f=e[0],g=e[1],h;c[0]!==a?(e=function(){g(null);var c=window.setInterval(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=a==null?null:yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchGetFTSNextTimestamp",{threadId:a},{isLoggingDisabled:!0});b=b!=null?parseInt(b,10):-1;g(b);b===0&&window.clearInterval(c)}),300);return function(){window.clearInterval(c)}},h=[a],c[0]=a,c[1]=e,c[2]=h):(e=c[1],h=c[2]);i(e,h);return f}g["default"]=a}),98);
__d("useMWInboxMessageSearchRestoreLoopAndStatus",["I64","Int64Hooks","LSIntEnum","LSMessagingThreadTypeUtil","LSSearchRequestStatusType","MAWMiActOnActThreadReadyDeferred","MWInboxMessageSearchContext.react","MWInboxMessageSearchStatusTypes","Promise","asyncToGeneratorRuntime","promiseDone","react","requireDeferred","useAsyncReStore","useMWInboxMessageSearchRestoreLoopLoadedUntilDate","useMWPConversatioSearchQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;e=i||d("react");e.useCallback;var l=e.useEffect,m=e.useState,n=e.c,o=c("requireDeferred")("MAWFTSRestoreSync").__setRef("useMWInboxMessageSearchRestoreLoopAndStatus");function p(a){if(a==null)return d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.NOT_STARTED;if((j||(j=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").PENDING)))return d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.IN_PROGRESS;if((j||(j=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").COMPLETE)))return d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.COMPLETE;return(j||(j=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").FAILED))?d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.FAILED:d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.NOT_STARTED}function a(a){var e=n(21),f=a.threadKey;a=d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType);var g=d("MWInboxMessageSearchContext.react").useMWInboxMessageSearchContext(),i=g.resultCount,j=g.searchResults;g=g.status;var k=j.length>0;e[0]!==g?(j=p(g),e[0]=g,e[1]=j):j=e[1];var q=j,r=c("useAsyncReStore")();g=m(null);j=g[0];var s=g[1];g=m(null);var t=g[0],u=g[1];g=c("useMWPConversatioSearchQPLLogger")();var v=g.qplSuccess,w=g.updateCurrentResultCount,x;e[2]!==r||e[3]!==f?(g=function(){var a=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield r);c("promiseDone")(c("MAWMiActOnActThreadReadyDeferred")(a,f,"MWInboxMessageSearchPanel.react",function(a,d){o.onReady(function(a){a=a.getFTSRestoreSync;a().setActiveThreadId(d);c("promiseDone")(a().startSyncingLoop());u(a())});s(d);return(h||(h=b("Promise"))).resolve()}))});function a(){return d.apply(this,arguments)}return a}();c("promiseDone")(a())},x=[r,f],e[2]=r,e[3]=f,e[4]=g,e[5]=x):(g=e[4],x=e[5]);d("Int64Hooks").useEffectInt64(g,x);e[6]!==t?(g=function(){t!=null&&(t.resetEBAvailability(),t.isStarted()||c("promiseDone")(t.startSyncingLoop()))},e[6]=t,e[7]=g):g=e[7];var y=g;x=c("useMWInboxMessageSearchRestoreLoopLoadedUntilDate")(j);bb0:{if(!a){g=d("MWInboxMessageSearchStatusTypes").RestoreStatus.NOT_REQUIRED;break bb0}if(t==null||!(t==null?void 0:t.isStarted())||x==null){g=d("MWInboxMessageSearchStatusTypes").RestoreStatus.NOT_RUNNING;break bb0}if(x===0){g=d("MWInboxMessageSearchStatusTypes").RestoreStatus.COMPLETE;break bb0}g=d("MWInboxMessageSearchStatusTypes").RestoreStatus.IN_PROGRESS}var z=g;bb1:{if(q===d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.NOT_STARTED){j=d("MWInboxMessageSearchStatusTypes").OverallStatus.NOT_STARTED;break bb1}if(z===d("MWInboxMessageSearchStatusTypes").RestoreStatus.IN_PROGRESS){j=d("MWInboxMessageSearchStatusTypes").OverallStatus.IN_PROGRESS;break bb1}if(q===d("MWInboxMessageSearchStatusTypes").PrimarySearchStatus.IN_PROGRESS){j=d("MWInboxMessageSearchStatusTypes").OverallStatus.IN_PROGRESS;break bb1}j=d("MWInboxMessageSearchStatusTypes").OverallStatus.COMPLETE}var A=j;e[8]!==A||e[9]!==i||e[10]!==w||e[11]!==v?(a=function(){A===d("MWInboxMessageSearchStatusTypes").OverallStatus.COMPLETE&&(i!=null&&w(i),v())},x=[A,v,i,w],e[8]=A,e[9]=i,e[10]=w,e[11]=v,e[12]=a,e[13]=x):(a=e[12],x=e[13]);l(a,x);e[14]!==y||e[15]!==k||e[16]!==A||e[17]!==z||e[18]!==q?(g=function(){return{onEBOnboarded:y,status:{hasSomeResults:k,overallSearchStatus:A,restoreStatus:z,searchStatus:q}}},j=[y,A,z,k,q],e[14]=y,e[15]=k,e[16]=A,e[17]=z,e[18]=q,e[19]=g,e[20]=j):(g=e[19],j=e[20]);return d("Int64Hooks").useMemoInt64(g,j)}g["default"]=a}),98);